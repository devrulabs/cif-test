<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CIF Console Controls</title>
</head>
<body>
    <div style="padding: 20px; font-family: monospace;">
        Open browser console (F12) and use these commands:
        <ul>
            <li>cifDock()</li>
            <li>cifMinimize()</li>
            <li>cifHide()</li>
            <li>cifGetMode()</li>
        </ul>
    </div>

    <script>
        // Initialize CIF
        const script = document.createElement("script");
        const apiSrc = `${document.referrer}/webresources/Widget/msdyn_ciLibrary.js`;
        
        // Make functions globally available
        window.DisplayMode = Object.freeze({
            Minimized: 0,
            Docked: 1,
            Hidden: 2
        });

        // Helper to get mode name
        window.getModeName = (mode) => {
            return Object.keys(DisplayMode).find(key => DisplayMode[key] === mode) || 'Unknown';
        };

        // Console-friendly functions
        window.cifGetMode = async () => {
            try {
                const mode = await window.Microsoft?.CIFramework?.getMode();
                console.log(`Current mode: ${getModeName(mode)} (${mode})`);
                return mode;
            } catch (error) {
                console.error('Error getting mode:', error);
            }
        };

        window.cifSetMode = async (mode) => {
            try {
                await window.Microsoft?.CIFramework?.setMode(mode);
                console.log(`Set mode to: ${getModeName(mode)} (${mode})`);
                return true;
            } catch (error) {
                console.error('Error setting mode:', error);
                return false;
            }
        };

        // Convenience functions
        window.cifDock = () => cifSetMode(DisplayMode.Docked);
        window.cifMinimize = () => cifSetMode(DisplayMode.Minimized);
        window.cifHide = () => cifSetMode(DisplayMode.Hidden);

        // Load CIF library
        script.type = "text/javascript";
        script.src = apiSrc;
        document.body.appendChild(script);

        script.onload = () => {
            console.log('CIF library loaded successfully. Available commands:');
            console.log('- cifDock() - Dock the panel');
            console.log('- cifMinimize() - Minimize the panel');
            console.log('- cifHide() - Hide the panel');
            console.log('- cifGetMode() - Get current mode');
            cifGetMode(); // Show initial mode
        };

        script.onerror = () => {
            console.error(`Failed to load CIF library from: ${apiSrc}`);
        };
    </script>
</body>
</html>
